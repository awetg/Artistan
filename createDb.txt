CREATE TABLE user (
user_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY, 
fullname VARCHAR(100),
email VARCHAR(100), 
username VARCHAR(100),
password VARCHAR(255),
admin  tinyint(1) NOT NULL DEFAULT 0
time_created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
CONSTRAINT `unique_username` UNIQUE (username)
CONSTRAINT `unique_email` UNIQUE (email)
);

CREATE TABLE avatar (
avatar_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
user_id SMALLINT UNSIGNED NOT NULL,
path TEXT,
mimetype VARCHAR(100),
encoding VARCHAR(100),
CONSTRAINT `fk_user_id_avatar` FOREIGN KEY (user_id) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE media (
media_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY, 
filename TEXT,
path TEXT,
mimetype VARCHAR(100),
encoding VARCHAR(100),
time_created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
owner SMALLINT UNSIGNED NOT NULL,
CONSTRAINT `fk_user_id` FOREIGN KEY (owner) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE category (
category_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY, 
name TEXT,
UNIQUE KEY `unique_category_name` (`name`)
);

CREATE TABLE comment (
comment_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY, 
content TEXT,
time_creatd TIMESTAMP,
owner SMALLINT UNSIGNED NOT NULL,
parent_post SMALLINT UNSIGNED NOT NULL,
CONSTRAINT `fk_commenter_id` FOREIGN KEY (owner) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT `fk_parent_post_id` FOREIGN KEY (parent_post) REFERENCES post (post_id) ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE post(
post_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
title TEXT,
media SMALLINT UNSIGNED NOT NULL,
owner SMALLINT UNSIGNED NOT NULL,
CONSTRAINT `fk_file_id` FOREIGN KEY (media) REFERENCES media (media_id) ON DELETE CASCADE ON UPDATE RESTRICT,
);




CREATE TABLE follower(
follower_id SMALLINT UNSIGNED NOT NULL,
followed_id SMALLINT UNSIGNED NOT NULL,
CONSTRAINT `fk_follower_id` FOREIGN KEY (follower_id) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT `fk_followed_id` FOREIGN KEY (followed_id) REFERENCES user (user_id) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE user_interests (
user_id SMALLINT UNSIGNED NOT NULL,
category_id SMALLINT UNSIGNED NOT NULL,
CONSTRAINT `fk_iuser_id` FOREIGN KEY (user_id) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT `fk_category_id` FOREIGN KEY (category_id) REFERENCES category (category_id) ON DELETE CASCADE ON UPDATE CASCADE
);

--relate a post with category
CREATE TABLE post_category (
post_id SMALLINT UNSIGNED NOT NULL,
category_id SMALLINT UNSIGNED NOT NULL,
CONSTRAINT `fk_posT_id` FOREIGN KEY (post_id) REFERENCES post (post_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT `fk_pcategory_id` FOREIGN KEY (category_id) REFERENCES category (category_id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE likes_post(
user_id SMALLINT UNSIGNED NOT NULL,
post_id SMALLINT UNSIGNED NOT NULL,
CONSTRAINT `fk_liker_user_id` FOREIGN KEY (user_id) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT `fk_liked_post_id` FOREIGN KEY (post_id) REFERENCES post (post_id) ON DELETE CASCADE ON UPDATE CASCADE
);